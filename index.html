<!-- MEJORAS HTML -->

<!-- 1. A√±adir soporte para tema oscuro con data attributes -->
<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tokens.ME</title>
    
    <!-- PWA Meta tags -->
    <meta name="theme-color" content="#0c2d48">
    <meta name="description" content="Sistema de geolocalizaci√≥n y seguimiento Tokens.ME">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- PWA Icons -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.3/leaflet.css" />
    <!-- Leaflet Marker Cluster CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/MarkerCluster.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/MarkerCluster.Default.css" />
    
    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Preconnect para mejorar rendimiento -->
    <link rel="preconnect" href="https://tile.openstreetmap.org">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
</head>
<body>
    <!-- Spinner de carga inicial -->
    <div id="splash-screen" class="splash-screen">
        <div class="splash-logo">Tokens.ME</div>
        <div class="splash-spinner"></div>
        <div class="splash-message">Cargando aplicaci√≥n...</div>
    </div>

    <div class="container" id="main-container">
        <!-- Contenido de autenticaci√≥n (igual que antes) -->
        <div id="auth-container" class="auth-box">
            <!-- ... -->
        </div>
        
        <!-- Contenido principal con mejoras -->
        <div id="app-container" style="display: none;">
            <!-- Mismo contenido que antes pero con adiciones -->
            
            <!-- A√±adir bot√≥n de opciones -->
            <button id="options-btn" class="floating-btn options-btn">
                <span class="btn-icon">‚öôÔ∏è</span>
            </button>
            
            <!-- A√±adir bot√≥n para activar/desactivar clustering -->
            <button id="toggle-cluster" class="floating-btn cluster-btn">
                <span class="btn-icon">üìç</span>
            </button>
            
            <!-- Indicador de conexi√≥n -->
            <div id="connection-status" class="connection-status">
                <span class="status-icon online">üü¢</span>
                <span class="status-text">En l√≠nea</span>
            </div>
            
            <!-- Men√∫ de opciones avanzadas -->
            <div id="options-menu" class="options-menu">
                <div class="options-header">
                    <h3>Opciones Avanzadas</h3>
                    <button id="close-options" class="close-btn">√ó</button>
                </div>
                <div class="options-content">
                    <div class="option-group">
                        <h4>Exportar Datos</h4>
                        <div class="option-actions">
                            <button id="export-json" class="btn-small">Exportar como JSON</button>
                            <button id="export-csv" class="btn-small">Exportar como CSV</button>
                        </div>
                    </div>
                    
                    <div class="option-group">
                        <h4>Tema de la Aplicaci√≥n</h4>
                        <div class="option-actions theme-selector">
                            <button data-theme="light" class="theme-btn active">
                                <span class="theme-icon">‚òÄÔ∏è</span>
                                <span>Claro</span>
                            </button>
                            <button data-theme="dark" class="theme-btn">
                                <span class="theme-icon">üåô</span>
                                <span>Oscuro</span>
                            </button>
                            <button data-theme="system" class="theme-btn">
                                <span class="theme-icon">üñ•Ô∏è</span>
                                <span>Sistema</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="option-group">
                        <h4>Notificaciones</h4>
                        <div class="option-actions">
                            <label class="toggle-switch">
                                <input type="checkbox" id="enable-notifications">
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">Permitir notificaciones</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="option-group">
                        <h4>Preferencias del Mapa</h4>
                        <div class="option-actions">
                            <label class="toggle-switch">
                                <input type="checkbox" id="enable-clustering" checked>
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">Agrupar marcadores cercanos</span>
                            </label>
                            
                            <div class="range-slider-container">
                                <label for="map-zoom">Zoom predeterminado:</label>
                                <input type="range" id="map-zoom" min="1" max="18" value="15" class="range-slider">
                                <span id="zoom-value">15</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="option-group">
                        <h4>Almacenamiento</h4>
                        <div class="option-actions">
                            <button id="clear-data" class="btn-small btn-danger">Borrar todos los datos</button>
                        </div>
                        <div class="storage-info">
                            <p>Almacenamiento usado: <span id="storage-used">Calculando...</span></p>
                        </div>
                    </div>
                    
                    <div class="option-group">
                        <h4>Informaci√≥n de la App</h4>
                        <div class="app-info">
                            <p>Versi√≥n: 2.0.0</p>
                            <p>Desarrollado por: Devinson Stik MQ</p>
                            <p>¬© 2025 Tokens.ME</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- P√°gina de offline -->
            <div id="offline-message" class="offline-message" style="display: none;">
                <div class="offline-icon">üì∂</div>
                <h3>Sin conexi√≥n a internet</h3>
                <p>No se pueden actualizar los datos. Ver√°s informaci√≥n guardada previamente.</p>
                <button id="retry-connection" class="btn">Reintentar conexi√≥n</button>
            </div>
        </div>
    </div>
    
    <!-- Plantilla para p√°gina offline -->
    <template id="offline-page-template">
        <div class="offline-page">
            <div class="offline-header">
                <h1>Tokens.ME</h1>
                <div class="offline-badge">Sin conexi√≥n</div>
            </div>
            <div class="offline-content">
                <div class="offline-icon">üì°</div>
                <h2>Sin conexi√≥n a internet</h2>
                <p>Actualmente est√°s navegando en modo offline.</p>
                <p>Algunas funciones no estar√°n disponibles hasta que recuperes la conexi√≥n.</p>
                <div class="offline-actions">
                    <button class="btn retry-btn">Reintentar conexi√≥n</button>
                </div>
                
                <div class="offline-data-section">
                    <h3>Datos guardados disponibles:</h3>
                    <div id="offline-data-list">
                        <!-- Aqu√≠ se mostrar√°n los datos guardados -->
                    </div>
                </div>
            </div>
        </div>
    </template>
    
    <!-- Scripts externos -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.3/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/leaflet.markercluster.js"></script>
    
    <!-- Custom JS -->
    <script src="script.js"></script>
</body>
</html>